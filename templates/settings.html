<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Wire Label Generator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <h1>Wire Label Generator Settings</h1>
        
        <!-- Status Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <!-- Profile Management -->
        <div class="settings-section">
            <h2>Profile Management</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="existing_profiles">Load Existing Profile:</label>
                    <select id="existing_profiles" onchange="loadSelectedProfile()">
                        <option value="">-- Select Profile --</option>
                        {% for profile_name in profiles %}
                            <option value="{{ profile_name }}" {{ 'selected' if profile_name == current_profile else '' }}>
                                {{ profile_name }}
                            </option>
                        {% endfor %}
                    </select>
                    <button type="button" class="btn-primary" onclick="loadSelectedProfile()">Load Profile</button>
                </div>
                <div class="form-group">
                    <label for="profile_name">Save New Profile:</label>
                    <input type="text" name="profile_name" id="profile_name" placeholder="Enter new profile name">
                    <button type="button" class="btn-success" onclick="saveProfile()">Save Profile</button>
                </div>
            </div>
            
            {# <div class="form-row">
                <div class="form-group">
                    <button type="button" class="btn-primary" onclick="loadSelectedProfile()">Load Profile</button>
                </div>
                <div class="form-group">
                    <button type="button" class="btn-success" onclick="saveProfile()">Save Profile</button>
                </div>
            </div> #}
        </div>
        
        <!-- Label Settings -->
        <div class="settings-section">
            <h2>Label Settings</h2>
            
            <form method="POST" action="{{ url_for('settings') }}">
                <input type="hidden" name="action" value="update_settings">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="label_width">Label Width (inches):</label>
                        <input type="number" name="label_width" id="label_width" step="0.001" min="0.1" max="10" 
                               value="{{ "%.3f"|format(settings.width_inches if settings else 6.0) }}">
                        <div class="help-text">Physical width of each label on the sheet</div>
                    </div>
                    <div class="form-group">
                        <label for="label_height">Label Height (inches):</label>
                        <input type="number" name="label_height" id="label_height" step="0.001" min="0.1" max="8" 
                               value="{{ "%.3f"|format(settings.label_printable_height_inches if settings else 4.0) }}">
                        <div class="help-text">Physical height of each label on the sheet</div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="margin_top">Top Margin (inches):</label>
                        <input type="number" name="margin_top" id="margin_top" step="0.001" min="0" max="2" 
                               value="{{ "%.3f"|format(settings.page_margin_top_inches if settings else 0.5) }}">
                        <div class="help-text">Distance from top edge of page to first label</div>
                    </div>
                    <div class="form-group">
                        <label for="margin_left">Left Margin (inches):</label>
                        <input type="number" name="margin_left" id="margin_left" step="0.001" min="0" max="2" 
                               value="{{ "%.3f"|format(settings.page_margin_left_inches if settings else 0.5) }}">
                        <div class="help-text">Distance from left edge of page to first label</div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="lines_per_label">Lines Per Label:</label>
                        <input type="number" name="lines_per_label" id="lines_per_label" min="1" max="10" 
                               value="{{ settings.lines_per_label if settings else 1 }}">
                        <div class="help-text">Number of text lines to print on each label</div>
                    </div>
                    <div class="form-group">
                        <label for="labels_per_row">Labels Per Row:</label>
                        <input type="number" name="labels_per_row" id="labels_per_row" min="1" max="10" 
                               value="{{ settings.labels_per_row if settings else 1 }}">
                        <div class="help-text">Number of labels to print across the page</div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="horizontal_spacing">Horizontal Spacing (inches):</label>
                        <input type="number" name="horizontal_spacing" id="horizontal_spacing" step="0.001" min="0" max="12" 
                               value="{{ "%.3f"|format(settings.label_spacing_horizontal_inches if settings else 4.0) }}">
                        <div class="help-text">Distance between labels horizontally (left to left)</div>
                    </div>
                    <div class="form-group">
                        <label for="vertical_spacing">Vertical Spacing (inches):</label>
                        <input type="number" name="vertical_spacing" id="vertical_spacing" step="0.001" min="0" max="5" 
                               value="{{ "%.3f"|format(settings.label_spacing_vertical_inches if settings else 1.8) }}">
                        <div class="help-text">Distance between labels vertically (top to top)</div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="font_name">Font Style:</label>
                        <select name="font_name" id="font_name">
                            <option value="Arial" {{ 'selected' if settings and settings.font_name == 'Arial' else '' }}>Arial</option>
                            <option value="Helvetica" {{ 'selected' if settings and settings.font_name == 'Helvetica' else '' }}>Helvetica</option>
                            <option value="Verdana" {{ 'selected' if settings and settings.font_name == 'Verdana' else '' }}>Verdana</option>
                            <option value="Times-Roman" {{ 'selected' if settings and settings.font_name == 'Times-Roman' else '' }}>Times Roman</option>
                            <option value="Courier" {{ 'selected' if settings and settings.font_name == 'Courier' else '' }}>Courier</option>
                        </select>
                        <div class="help-text">Font family for label text</div>
                    </div>
                    <div class="form-group">
                        <label for="font_size">Font Size:</label>
                        <input type="number" name="font_size" id="font_size" min="6" max="72" 
                               value="{{ settings.font_size if settings else 8 }}">
                        <div class="help-text">Size of text in points (pt)</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="font_bold">
                        <input type="checkbox" name="font_bold" id="font_bold" {{ 'checked' if settings and settings.font_bold else '' }}>
                        Bold Font
                    </label>
                    <div class="help-text">Make all label text bold for better readability</div>
                </div>
                
                <div class="button-group">
                    <button type="submit" class="btn-primary">Save Settings</button>
                </div>
            </form>
        </div>
        
        <!-- Navigation -->
        <div class="button-group">
            <a href="/" class="btn btn-secondary">Back to Labels</a>
            <a href="/logout" class="btn btn-danger">Logout</a>
        </div>
    </div>

    <script>
        function loadSelectedProfile() {
            const profileDropdown = document.getElementById('existing_profiles');
            const profileName = profileDropdown.value;
            
            if (!profileName) {
                alert('Please select a profile');
                return;
            }
            
            // Send request to load profile
            fetch('/load_profile', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ profile_name: profileName })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Update form fields with loaded profile data
                    const settings = data.settings;
                    document.getElementById('label_width').value = settings.width_inches;
                    document.getElementById('label_height').value = settings.label_printable_height_inches;
                    document.getElementById('margin_top').value = settings.page_margin_top_inches;
                    document.getElementById('margin_left').value = settings.page_margin_left_inches;
                    document.getElementById('lines_per_label').value = settings.lines_per_label || 1;
                    document.getElementById('labels_per_row').value = settings.labels_per_row || 1;
                    document.getElementById('horizontal_spacing').value = settings.label_spacing_horizontal_inches;
                    document.getElementById('vertical_spacing').value = settings.label_spacing_vertical_inches;
                    document.getElementById('font_name').value = settings.font_name;
                    document.getElementById('font_size').value = settings.font_size;
                    document.getElementById('font_bold').checked = settings.font_bold;
                    
                    alert('Profile "' + profileName + '" loaded successfully!');
                } else {
                    alert('Error loading profile: ' + data.error);
                }
            })
            .catch(error => {
                alert('Error: ' + error);
            });
        }
        
        function saveProfile() {
            const profileName = document.getElementById('profile_name').value;
            if (!profileName) {
                alert('Please enter a profile name');
                return;
            }
            
            const settings = {
                width_inches: parseFloat(document.getElementById('label_width').value),
                label_printable_height_inches: parseFloat(document.getElementById('label_height').value),
                page_margin_top_inches: parseFloat(document.getElementById('margin_top').value),
                page_margin_left_inches: parseFloat(document.getElementById('margin_left').value),
                lines_per_label: parseInt(document.getElementById('lines_per_label').value),
                labels_per_row: parseInt(document.getElementById('labels_per_row').value),
                label_spacing_horizontal_inches: parseFloat(document.getElementById('horizontal_spacing').value),
                label_spacing_vertical_inches: parseFloat(document.getElementById('vertical_spacing').value),
                font_name: document.getElementById('font_name').value,
                font_size: parseInt(document.getElementById('font_size').value),
                font_bold: document.getElementById('font_bold').checked
            };
            
            // Send request to save profile
            fetch('/save_profile', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 
                    profile_name: profileName,
                    settings: settings
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Profile "' + profileName + '" saved successfully!');
                    // Clear the input field
                    document.getElementById('profile_name').value = '';
                    // Reload page to update dropdown
                    window.location.reload();
                } else {
                    alert('Error saving profile: ' + data.error);
                }
            })
            .catch(error => {
                alert('Error: ' + error);
            });
        }
    </script>
</body>
</html>
